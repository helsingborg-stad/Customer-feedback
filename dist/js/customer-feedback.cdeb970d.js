(()=>{"use strict";const t=()=>{function t(){this.parentDomElement=document.querySelector("[data-js-cf]"),this.parentDomElement&&(this.getSettings(this.parentDomElement),this.renderInitialState(this.parentDomElement),this.handleFeedbackButtons(this.parentDomElement),this.handleTopicSelection(this.parentDomElement),this.handleCommentFormSubmission(this.parentDomElement))}return t.prototype.getSettings=function(t){try{this.settings=JSON.parse(t.getAttribute("data-js-cf"))}catch(t){console.error("Invalid settings JSON data in data-js-cf attribute:",t)}},t.prototype.renderInitialState=function(t){this.hidePartial("notices"),this.hidePartial("topics"),this.hidePartial("comment"),this.hidePartial("gdpr"),this.hideNotice("error"),this.hideNotice("success"),this.hasGivenFeedback(this.settings.postId,this.settings.frequency)?(this.showNotice("alreadysubmitted"),this.hidePartial("buttons")):(this.hideNotice("alreadysubmitted"),this.showPartial("buttons"))},t.prototype.handleFeedbackButtons=function(t){let e=this;const i=t.querySelectorAll("[data-js-cf-action]");i.length>0&&i.forEach(i=>{i.addEventListener("click",function(i){i.preventDefault(),i.stopPropagation(),this.setAttribute("aria-pressed","true"),e.submitInitialResponse(t,e.settings.postId,this.getAttribute("data-js-cf-action"))})})},t.prototype.handleTopicSelection=function(t){let e=this;const i=t.querySelectorAll("[data-js-cf-topic]");i.length>0&&i.forEach(t=>{t.addEventListener("click",function(t){e.showPartial("comment"),"true"===this.getAttribute("data-js-cf-has-written-feedback-capability")?(e.showPartial("gdpr"),e.showSubPartial("text"),e.showSubPartial("submit"),"true"===this.getAttribute("data-js-cf-has-written-feedback-email")?e.showSubPartial("email"):e.hideSubPartial("email")):(e.hidePartial("gdpr"),e.hideSubPartial("text"),e.hideSubPartial("email"),e.showSubPartial("submit"))})})},t.prototype.handleCommentFormSubmission=function(t){let e=this;const i=t.querySelector("form");i&&i.addEventListener("submit",function(t){t.preventDefault(),t.stopPropagation(),e.showLoader(),e.hideNotice("error"),e.hideNotice("success");let o=new FormData(i);o.append("action","submit_comment"),o.append("answerid",e.initialFeedbackId),o.append("postid",e.settings.postId),fetch(ajaxurl,{method:"POST",credentials:"same-origin",headers:{"Cache-Control":"no-cache"},body:o}).then(t=>{if(200!=t.status)throw new Error("Invalid response");return t.json()}).then(t=>{if(!t.data.id)throw new Error("Invalid response (no id)");return t}).then(t=>{e.showNotice("success"),e.hidePartial("topics"),e.hidePartial("comment"),e.hidePartial("gdpr")}).catch(t=>{console.error(t),e.showNotice("error")}).finally(()=>{e.hideLoader()})})},t.prototype.submitInitialResponse=function(t,e,i){let o={action:"submit_response",postid:e,answer:i};this.showLoader(),fetch(ajaxurl,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:new URLSearchParams(o)}).then(t=>{if(200!=t.status)throw new Error("Invalid response");return t.json()}).then(t=>{if(!t.data.id)throw new Error("Invalid response (no id)");return t}).then(t=>(this.hidePartial("buttons"),t)).then(t=>{this.registerFeedBackGiven(e,this.settings.frequency),Array.isArray(this.settings.topics)&&this.settings.topics.length>1?(this.initialFeedbackId=t.data.id,this.showPartial("topics"),this.showPartial("send")):this.showNotice("success")}).catch(t=>(console.error(t),this.showNotice("error"),this.hidePartial("buttons"),!1)).finally(()=>{this.hideLoader()})},t.prototype.showNotice=function(t){this.showHideNotice(t,!0)},t.prototype.hideNotice=function(t){this.showHideNotice(t,!1)},t.prototype.showHideNotice=function(t,e){0==e?this.hidePartial("notices"):this.showPartial("notices"),this.showHideByKey("data-js-cf-notification",t,e)},t.prototype.showPartial=function(t){this.showHidePartial(t,!0)},t.prototype.hidePartial=function(t){this.showHidePartial(t,!1)},t.prototype.showSubPartial=function(t){this.showHideSubPartial(t,!0)},t.prototype.hideSubPartial=function(t){this.showHideSubPartial(t,!1)},t.prototype.showHideSubPartial=function(t,e){this.showHideByKey("data-js-cf-sub-part",t,e)},t.prototype.showHidePartial=function(t,e){this.showHideByKey("data-js-cf-part",t,e)},t.prototype.showHideByKey=function(t,e,i){const o=this.parentDomElement.querySelector("["+t+'="'+e+'"]');o&&this.toggleDisplay(o,i)},t.prototype.toggleDisplay=function(t,e){if(!t)return;const i=/u-display--\S+/g,o=[...t.classList].filter(t=>i.test(t));if(e){const e=t.getAttribute("data-display-toggle");e&&(t.classList.add(...e.split(" ")),t.removeAttribute("data-display-toggle")),t.classList.remove("u-display--none");const i=t.querySelectorAll("input, textarea, button, select");i.length>0&&i.forEach(t=>{t.disabled=!1})}else{o.length>0&&(t.setAttribute("data-display-toggle",o.join(" ")),t.classList.remove(...o)),t.classList.add("u-display--none");const e=t.querySelectorAll("input, textarea, button, select");e.length>0&&e.forEach(t=>{t.disabled=!0})}},t.prototype.showLoader=function(){this.parentDomElement.querySelector("[data-js-cf-loader]").style.display="block"},t.prototype.hideLoader=function(){this.parentDomElement.querySelector("[data-js-cf-loader]").style.display="none"},t.prototype.hasGivenFeedback=function(t,e=7){if(!t)return!1;const i=(JSON.parse(localStorage.getItem("givenFeedback"))||{})[t]||0;return(Date.now()-i)/864e5<e},t.prototype.registerFeedBackGiven=function(t,e=7){if(!t)return!1;if(0==e)return!0;let i=JSON.parse(localStorage.getItem("givenFeedback"))||{},o=Date.now();return(o-(i[t]||0))/864e5>=e&&(i[t]=o,localStorage.setItem("givenFeedback",JSON.stringify(i)),!0)},new t};window.addEventListener("DOMContentLoaded",function(e){t()})})();
//# sourceMappingURL=customer-feedback.cdeb970d.js.map